<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Ollama Chat UI</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Custom styles for essential features not covered by Bootstrap -->
    <style>
        /* Sidebar and panel styles */
        .sidebar, .panel {
            position: fixed;
            top: 0;
            height: 100vh;
            z-index: 1030;
            overflow-y: auto;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 280px;
        }

        .sidebar {
            left: -280px;
        }

        .panel {
            right: -350px;
            width: 350px;
        }

        .sidebar.show {
            left: 0;
        }

        .panel.show {
            right: 0;
        }

        /* Message styles */
        .message {
            max-width: 85%;
            border-radius: 18px;
            position: relative;
        }

        .user-message {
            margin-left: auto;
            border-bottom-right-radius: 6px;
        }

        .assistant-message {
            margin-right: auto;
            border-bottom-left-radius: 6px;
        }

        /* Code block styles */
        .code-block-wrapper {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
        }

        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 0;
        }

        [data-bs-theme="dark"] pre {
            background-color: #1a1a1a;
        }

        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
        }
    </style>
</head>
<body class="d-flex flex-column vh-100">

    <!-- Header/Navbar -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary" id="header">
        <div class="container-fluid">
            <div class="d-flex align-items-center">
                <button id="newChatBtn" class="btn btn-outline-primary me-2" title="Start a new conversation">
                    <i class="bi bi-plus-lg"></i> New Chat
                </button>
                <button id="conversationsBtn" class="btn btn-outline-secondary" title="View saved conversations">
                    <i class="bi bi-chat-left-text"></i> Conversations
                </button>
            </div>
            <div class="d-flex align-items-center mx-auto">
                <label for="modelSelect" class="me-2">Model:</label>
                <select id="modelSelect" class="form-select me-2" style="width: auto;"></select>
                <button id="settingsBtn" class="btn btn-outline-secondary" title="Model settings">
                    <i class="bi bi-gear"></i>
                </button>
            </div>
            <div class="d-flex align-items-center">
                <div id="status" class="me-3 text-secondary">Idle</div>
                <button id="themeToggleBtn" class="btn btn-outline-secondary" title="Toggle dark/light mode">
                    <i class="bi bi-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Conversations Sidebar (hidden by default) -->
    <div id="conversationsSidebar" class="sidebar bg-body-tertiary border-end">
        <div class="d-flex flex-column h-100">
            <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
                <h5 class="mb-0">Conversations</h5>
                <button id="closeSidebarBtn" class="btn-close" aria-label="Close"></button>
            </div>
            <div id="conversationsList" class="p-3 overflow-auto flex-grow-1">
                <!-- Conversations will be listed here -->
            </div>
            <div class="d-flex p-3 border-top">
                <button id="exportAllConversationsBtn" class="btn btn-outline-primary me-2 flex-grow-1" title="Export all conversations to a file">
                    <i class="bi bi-download"></i> Export
                </button>
                <button id="importConversationsBtn" class="btn btn-outline-secondary flex-grow-1" title="Import conversations from a file">
                    <i class="bi bi-upload"></i> Import
                </button>
                <input type="file" id="importFileInput" accept=".json" style="display: none;">
            </div>
        </div>
    </div>

    <!-- Settings Panel (hidden by default) -->
    <div id="settingsPanel" class="panel bg-body-tertiary border-start">
        <div class="d-flex flex-column h-100">
            <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
                <h5 class="mb-0">Model Settings</h5>
                <button id="closeSettingsBtn" class="btn-close" aria-label="Close"></button>
            </div>
            <div class="p-3 overflow-auto flex-grow-1">
                <div class="mb-4">
                    <h6 class="border-bottom pb-2 mb-3">Generation Parameters</h6>

                    <div class="mb-3">
                        <label for="temperatureSlider" class="form-label">Temperature: <span id="temperatureValue" class="badge bg-secondary">0.7</span></label>
                        <input type="range" class="form-range" id="temperatureSlider" min="0" max="2" step="0.1" value="0.7">
                        <div class="form-text">Controls randomness: lower values are more deterministic, higher values more creative.</div>
                    </div>

                    <div class="mb-3">
                        <label for="topPSlider" class="form-label">Top P: <span id="topPValue" class="badge bg-secondary">0.9</span></label>
                        <input type="range" class="form-range" id="topPSlider" min="0" max="1" step="0.05" value="0.9">
                        <div class="form-text">Controls diversity via nucleus sampling: 0.9 considers the top 90% most likely tokens.</div>
                    </div>

                    <div class="mb-3">
                        <label for="maxTokensInput" class="form-label">Max Tokens:</label>
                        <input type="number" class="form-control" id="maxTokensInput" min="10" max="4096" value="4096">
                        <div class="form-text">Maximum number of tokens to generate in the response.</div>
                    </div>
                </div>

                <div class="mb-4">
                    <h6 class="border-bottom pb-2 mb-3">System Prompt</h6>
                    <textarea class="form-control mb-2" id="systemPromptInput" placeholder="Enter a system prompt to set the behavior of the assistant..." rows="4"></textarea>
                    <div class="form-text">Instructions to the model that define how it should behave throughout the conversation.</div>
                </div>
            </div>

            <div class="p-3 border-top">
                <div class="d-flex justify-content-between">
                    <button id="resetSettingsBtn" class="btn btn-outline-secondary">Reset to Defaults</button>
                    <button id="saveSettingsBtn" class="btn btn-primary">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main chat area -->
    <div id="chatbox" class="container-fluid flex-grow-1 overflow-auto py-4">
        <!-- Chat messages will appear here -->
    </div>

    <!-- Input area -->
    <div class="container-fluid border-top py-3 bg-body-tertiary">
        <div class="row">
            <div class="col-12">
                <div class="input-group">
                    <textarea id="userInput" class="form-control" placeholder="Type your message here..." rows="1"></textarea>
                    <button id="sendButton" class="btn btn-primary">
                        <i class="bi bi-send"></i> Send
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- External JavaScript files -->
    <script src="js/conversations.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/api.js"></script>
    <script src="js/main.js"></script>

</body>
</html>
